
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitkub Full Monitor</title>
  <style>
    body { background: #0d1117; color: #fff; font-family: sans-serif; margin: 0; }
    .container { padding: 10px; }
    .coin-box {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 12px;
    }
    .coin-box h2 { margin: 0 0 6px; color: #58a6ff; }
    .coin-info span { display: block; margin: 2px 0; font-size: 14px; }
    .actions input { width: 100px; padding: 4px; margin-right: 6px; }
    .actions button { padding: 4px 8px; margin-top: 4px; }
    table { width: 100%; font-size: 10px; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #30363d; padding: 3px; text-align: center; }
    .history-title { margin-top: 24px; font-weight: bold; font-size: 14px; color: #2ea043; }
    #popup {
      position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%);
      background: #1f6feb; color: white; padding: 20px; border-radius: 8px;
      display: none; z-index: 999;
    }
  </style>
</head>
<body>
<div class="container">
  <div id="popup"></div>
  <div id="coin-container"></div>

  <div class="history-title">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≤‡∏¢</div>
  <table>
    <thead>
      <tr>
        <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏ã‡∏∑‡πâ‡∏≠/‡∏Ç‡∏≤‡∏¢</th>
        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
        <th>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
        <th>‡∏Å‡∏≥‡πÑ‡∏£</th>
      </tr>
    </thead>
    <tbody id="history-body"></tbody>
  </table>
</div>

<script>
const coins = ["BTC", "ETH", "KUB", "DOGE"];
const priceMap = {};
const apiURL = "https://api.bitkub.com/api/market/ticker";
let lastBuy = {};

function showPopup(msg) {
  const popup = document.getElementById("popup");
  popup.textContent = msg;
  popup.style.display = "block";
  setTimeout(() => popup.style.display = "none", 3000);
}

async function fetchPrices() {
  const res = await fetch(apiURL);
  const data = await res.json();
  for (let coin of coins) {
    const symbol = 'THB_' + coin;
    priceMap[coin] = data[symbol]?.last || 0;
  }
  renderCoins();
}

function renderCoins() {
  const container = document.getElementById("coin-container");
  container.innerHTML = "";
  coins.sort((a, b) => priceMap[b] - priceMap[a]);
  for (let coin of coins) {
    const price = priceMap[coin];
    const trend = getTrend(price, coin);
    const advice = getAdvice(price, coin);
    container.innerHTML += `
      <div class="coin-box">
        <h2>${coin}/THB</h2>
        <div class="coin-info">
          <span>üìà ‡∏£‡∏≤‡∏Ñ‡∏≤: ${price.toLocaleString()} ‡∏ö‡∏≤‡∏ó</span>
          <span>üìä ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°: ${trend}</span>
          <span>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ${advice}</span>
          <span>üí∏ ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì: 0.25%</span>
        </div>
        <div class="actions">
          <input type="number" id="amt-${coin}" placeholder="‡∏ö‡∏≤‡∏ó">
          <button onclick="record('${coin}', 'BUY')">‡∏ã‡∏∑‡πâ‡∏≠</button>
          <button onclick="record('${coin}', 'SELL')">‡∏Ç‡∏≤‡∏¢</button>
        </div>
      </div>
    `;
    if (advice.includes("‡∏Ñ‡∏ß‡∏£‡∏ã‡∏∑‡πâ‡∏≠") || advice.includes("‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏≤‡∏¢")) {
      showPopup(`${coin}: ${advice}`);
    }
  }
}

function getTrend(price, coin) {
  if (!lastBuy[coin]) return "‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ã‡∏∑‡πâ‡∏≠";
  if (price > lastBuy[coin]) return "üìà ‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô";
  if (price < lastBuy[coin]) return "üìâ ‡∏Ç‡∏≤‡∏•‡∏á";
  return "‚è∏ ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà";
}

function getAdvice(price, coin) {
  if (!lastBuy[coin]) return "üìå ‡∏£‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏Å";
  const diff = price - lastBuy[coin];
  if (diff >= 20) return "‚úÖ ‡∏Ñ‡∏ß‡∏£‡∏Ç‡∏≤‡∏¢ ‡∏Å‡∏≥‡πÑ‡∏£‡∏î‡∏µ";
  if (diff <= -20) return "üü¢ ‡∏Ñ‡∏ß‡∏£‡∏ã‡∏∑‡πâ‡∏≠ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏Å";
  return "üîÑ ‡∏£‡∏≠‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô";
}

function record(coin, type) {
  const amount = parseFloat(document.getElementById("amt-" + coin).value || "0");
  const price = priceMap[coin];
  if (!amount || !price) return alert("‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
  const qty = amount / price;
  const now = new Date();
  const time = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
  const date = now.toLocaleDateString('th-TH');
  if (type === "BUY") lastBuy[coin] = price;
  const gain = type === "SELL" && lastBuy[coin] ? ((price - lastBuy[coin]) * qty).toFixed(2) : "-5.00";
  const row = {
    datetime: `${date} ${time}`,
    type,
    price,
    amount,
    qty: qty.toFixed(6),
    profit: gain
  };
  const history = JSON.parse(localStorage.getItem("trade-history") || "[]");
  history.push(row);
  localStorage.setItem("trade-history", JSON.stringify(history));
  renderHistory();
}

function renderHistory() {
  const history = JSON.parse(localStorage.getItem("trade-history") || "[]");
  const body = document.getElementById("history-body");
  body.innerHTML = "";
  for (let row of history.reverse()) {
    body.innerHTML += `<tr>
      <td>${row.datetime}</td>
      <td>${row.type}</td>
      <td>${row.price}</td>
      <td>${row.amount}</td>
      <td>${row.qty}</td>
      <td>${row.profit}</td>
    </tr>`;
  }
}

fetchPrices();
renderHistory();
</script>
</body>
</html>
